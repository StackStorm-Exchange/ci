name: Tag Release

on:
  workflow_call:
#    inputs:

jobs:
  tag_release:
    runs-on: ubuntu-latest
    name: 'Tag Release'
    steps:
      - name: Checkout Pack Repo
        uses: actions/checkout@v2
        with:
          repository: lm-ydubler/logicmonitor-stackstorm-pack
          fetch-depth: 0
        
      - name: Tag Scripting
        shell: bash
        run: |
          pwd
          ls
          echo "sup"
          git status
          if latestTag=$(git describe --tags `git rev-list --tags --max-count=1`); then
            echo latestTag = $latestTag
          fi
          if [[ -z "$latestTag" ]]; then
            echo "latestTag is NULL"
          else
            echo "latestTag is NOT NULL"
          fi
          version=$(grep 'version:' pack.yaml)
          version2="${(grep 'version:' pack.yaml)#version:}"
          version3="$(echo -e "{"${(grep 'version:' pack.yaml)#version:}"}" | tr -d '[:space:]')"
          echo version in pack.yaml=$version
          echo version2=$version2
          echo version3=$version3
          version="${version#version:}"
          echo version stripped=$version
          version_no_spaces="$(echo -e "${version}" | tr -d '[:space:]')"
          echo version_no_spaces=$version_no_spaces
          echo -e "\n"
          echo latestTag=$latestTag
          echo version=$version_no_spaces
          if [[ "$latestTag" == "$version_no_spaces" ]]; then
            echo "latestTag is the same as version!"
          else
            echo "latestTag is NOT the same as version!"
          fi
